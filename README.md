# Webm-API
Реализация API сервиса для утилиты [webm-grabber](https://github.com/d0kur0/webm-grabber) 

[TOC]

## Компиляция
Всё, что нужно это установленный компилятор [Golang](https://golang.org).
В целом этот шаг нужен только в том случае, если Вам понадобится изменить логику работы API, изменить порт и схему граббинга.

Скачать уже собранные бинарники можно на странице [Release](https://github.com/d0kur0/webm-api/releases), на данный момент там два вендора: 2ch, 4chan и все основные немертвые доски.

## Конфигурирование
### Тайм-аут между обновлением собранных грабером данных
По-умолчанию обновление происходит каждые 10 минут, изменить это можно в [данном файле](https://github.com/d0kur0/webm-api/blob/master/tasks/grabberTask/MainProcess.go#L14), значение указывается в минутах.

### Добавление своего вендора
Для этого придётся сделать форк от репозитория [d0kur0/webm-grabber](https://github.com/d0kur0/webm-grabber) (или сделать pull request), а так же к его README, в целом, всё, что нужно - имплементировать интерфейс вендора по аналогии, после этого, вам нужно в go.mod указать уже ваш форкнутый репозититорий или нужную версию в случае pull request, так или иначе для этого нужны знания Go и умение работать с его модулями.

### Схема граббинга
Схема граббинга описана в [данном файле](https://github.com/d0kur0/webm-api/blob/master/tasks/grabberTask/MainProcess.go#L21) не думаю, что могут возникнуть проблемы с добавлением / удалением досок и вендоров.

### Порт на котором работает API
За это отвечает консанта, находящаяся [здесь](https://github.com/d0kur0/webm-api/blob/master/ServerEntry.go#L15)

# Методы API
На данный момент есть всего три метода:

- files/getAll
- files/getByStruct
- schema/get

## files/getAll

Работает через метод GET возвращает вообще всех вендоров и их файлы, ответом является JSON строка, получаемая после преобразования структуры [Output](https://github.com/d0kur0/webm-grabber/blob/master/sources/types/Output.go#L12)

Пример ответа:
```json
{
  "Vendors": {
    "2ch": {
      "b": [
        {
          "Files": [
            {
              "Name": "15790813342170.webm",
              "Path": "https://2ch.hk//b/src/21…1874/15798954688140.webm",
              "Preview": "https://2ch.hk//b/thumb/…1874/15798954688140s.jpg",
              "ThreadId": 212221874
            }
          ]
        }
      ]
    }
  }
}
```

## files/getByStruct
Работает через метод POST, ответом является так же список вендоров, досок, тредов и файлов в них, структура ответа идентична методу files/getAll, но данный метод принимает в теле запроса JSON структуру для фильтрации вендоров и досок, проще говоря при запросе указываете только тех вендоров и их досок, которые вам нужны.

Тело запроса имеет такую структуру:
```json
{
  "vendors": {
    "2ch": ["b", "t"],
    "4chan": ["b", "a"]
  }
}
```

## schema/get
Работает через метод GET, ответом является текущая схема граббинга на сервере, которая была описана до компиляции, возвращает объект вендоров, значение вендора - массив доступных досок.

Например:
```json
{
    "2ch": [
        "b",
        "h",
        "fur"
    ],
    "4chan": [
        "b",
        "e",
        "h",
        "u"
    ]
}
```